<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MF Tracker</title>
<style>
body { font-family: Arial, sans-serif; padding: 10px; }
button { padding: 6px 10px; margin-right: 5px; margin-top: 5px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
input { width: 90px; }
.profit { color: green; font-weight: bold; }
.loss { color: red; font-weight: bold; }
#fundNameInput { width: 60%; padding: 5px; }
</style>
</head>
<body>

<h2>Mutual Fund Tracker</h2>

<!-- Fund input + Add button -->
<div>
  <input type="text" id="fundNameInput" placeholder="Enter fund name (partial)">
  <button onclick="addFundFromInput()">âž• Add Fund</button>
  <button onclick="refreshNAVs()">ðŸ”„ Refresh NAVs</button>
</div>

<!-- Table -->
<table>
  <thead>
    <tr>
      <th>Fund</th>
      <th>Buy Avg (â‚¹)</th>
      <th>Investment (â‚¹)</th>
      <th>Current NAV (â‚¹)</th>
      <th>P / L (â‚¹)</th>
    </tr>
  </thead>
  <tbody id="fundTable"></tbody>
</table>

<script>
let funds = JSON.parse(localStorage.getItem("funds") || "[]");

function save() {
  localStorage.setItem("funds", JSON.stringify(funds));
}

// Add fund from input box
function addFundFromInput() {
  if (funds.length >= 20) {
    alert("Max 20 funds allowed");
    return;
  }

  let q = document.getElementById("fundNameInput").value.trim();
  if (!q) {
    alert("Please enter a fund name");
    return;
  }

  fetch("https://api.mfapi.in/mf")
    .then(r => r.json())
    .then(list => {
      let match = list.find(f => f.schemeName.toLowerCase().includes(q.toLowerCase()));
      if (!match) {
        alert("Fund not found");
        return;
      }

      funds.push({
        name: match.schemeName,
        code: match.schemeCode,
        buyAvg: 0,
        invest: 0,
        nav: 0
      });

      save();
      render();
      document.getElementById("fundNameInput").value = ""; // clear input
    });
}

// Refresh NAVs from API
function refreshNAVs() {
  funds.forEach(f => {
    fetch(`https://api.mfapi.in/mf/${f.code}`)
      .then(r => r.json())
      .then(data => {
        f.nav = parseFloat(data.data[0].nav);
        save();
        render();
      });
  });
}

// Render table
function render() {
  let tbody = document.getElementById("fundTable");
  tbody.innerHTML = "";

  funds.forEach((f,i) => {
    let pl = 0;

    if(f.buyAvg > 0 && f.invest > 0 && f.nav > 0) {
      let units = f.invest / f.buyAvg;
      let currentValue = units * f.nav;
      pl = currentValue - f.invest;
    }

    tbody.innerHTML += `
      <tr>
        <td>${f.name}</td>
        <td>
          <input type="number" step="0.01" value="${f.buyAvg}" onchange="funds[${i}].buyAvg=this.value;save();render()">
        </td>
        <td>
          <input type="number" value="${f.invest}" onchange="funds[${i}].invest=this.value;save();render()">
        </td>
        <td>${f.nav || "-"}</td>
        <td class="${pl >= 0 ? 'profit' : 'loss'}">${pl.toFixed(2)}</td>
      </tr>
    `;
  });
}

render();
</script>

</body>
</html>
