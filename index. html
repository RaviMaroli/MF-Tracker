<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MF Tracker</title>
<style>
body { font-family: Arial, sans-serif; padding: 10px; }
button { padding: 6px 10px; margin-right: 5px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
input { width: 90px; }
.profit { color: green; font-weight: bold; }
.loss { color: red; font-weight: bold; }
</style>
</head>
<body>
<h2>Mutual Fund Tracker</h2>
<button onclick="addFund()">âž• Add Fund</button>
<button onclick="refreshNAVs()">ðŸ”„ Refresh NAVs</button>
<table>
<thead>
<tr>
<th>Fund</th>
<th>Buy Avg (â‚¹)</th>
<th>Investment (â‚¹)</th>
<th>Current NAV (â‚¹)</th>
<th>P / L (â‚¹)</th>
</tr>
</thead>
<tbody id="fundTable"></tbody>
</table>
<script>
let funds = JSON.parse(localStorage.getItem("funds") || "[]");
function save(){ localStorage.setItem("funds", JSON.stringify(funds)); }
function addFund(){
  if(funds.length>=20){ alert("Max 20 funds allowed"); return; }
  fetch("https://api.mfapi.in/mf")
    .then(r=>r.json())
    .then(list=>{
      let q=prompt("Enter fund name (partial):");
      if(!q)return;
      let match=list.find(f=>f.schemeName.toLowerCase().includes(q.toLowerCase()));
      if(!match){ alert("Fund not found"); return; }
      funds.push({name:match.schemeName, code:match.schemeCode, buyAvg:0, invest:0, nav:0});
      save(); render();
    });
}
function refreshNAVs(){
  funds.forEach(f=>{
    fetch(`https://api.mfapi.in/mf/${f.code}`)
      .then(r=>r.json())
      .then(data=>{ f.nav=parseFloat(data.data[0].nav); save(); render(); });
  });
}
function render(){
  let tbody=document.getElementById("fundTable");
  tbody.innerHTML="";
  funds.forEach((f,i)=>{
    let pl=0;
    if(f.buyAvg>0 && f.invest>0 && f.nav>0){
      let units=f.invest/f.buyAvg;
      let currentValue=units*f.nav;
      pl=currentValue-f.invest;
    }
    tbody.innerHTML+=`
      <tr>
        <td>${f.name}</td>
        <td><input type="number" step="0.01" value="${f.buyAvg}" onchange="funds[${i}].buyAvg=this.value;save();render()"></td>
        <td><input type="number" value="${f.invest}" onchange="funds[${i}].invest=this.value;save();render()"></td>
        <td>${f.nav || "-"}</td>
        <td class="${pl>=0?'profit':'loss'}">${pl.toFixed(2)}</td>
      </tr>
    `;
  });
}
render();
</script>
</body>
</html>
